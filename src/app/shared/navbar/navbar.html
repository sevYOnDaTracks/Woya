<nav class="fixed top-0 left-0 w-full z-[9999] bg-[#FFF7EB] shadow-md p-4 md:px-16 flex md:p-4 justify-between items-center">

  <h1 class="text-3xl font-extrabold text-[#FF7A00] tracking-tight">
    <a routerLink="/">Woya!</a>
  </h1>

  <div class="hidden md:flex flex-1 justify-center px-8">
    <div class="global-search" [class.global-search--open]="searchOpen">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-4.35-4.35M11 19a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z" />
      </svg>
      <input type="text"
             [value]="searchTerm"
             (input)="onSearchInput($event.target.value)"
             (focus)="onSearchFocus()"
             (keydown.enter)="submitSearch()"
             placeholder="Que cherchez vous ?">
      <button type="button" (click)="submitSearch()">OK</button>
      <div class="search-dropdown" *ngIf="searchOpen">
        <div *ngIf="searchLoading" class="search-state">Recherche…</div>
        <ng-container *ngIf="!searchLoading">
          <button type="button"
                  *ngFor="let result of searchResults"
                  class="search-item"
                  (click)="goToResult(result)">
            <img [src]="result.avatar || 'assets/icone.png'" alt="" class="search-item__avatar">
            <div class="search-item__body">
              <p class="search-item__title">{{ result.label }}</p>
              <p class="search-item__subtitle">{{ result.description }}</p>
            </div>
            <span class="search-item__tag" [class.search-item__tag--user]="result.kind === 'user'">
              {{ result.kind === 'user' ? 'Profil' : 'Service' }}
            </span>
          </button>
          <div class="search-state" *ngIf="!searchResults.length">
            Aucun résultat
          </div>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- ✅ Desktop -->
  <div class="hidden md:flex items-center gap-6">

    <a routerLink="/"
       routerLinkActive="active"
       [routerLinkActiveOptions]="{ exact: true }"
       aria-label="Site internet"
       title="Site internet"
       class="menu-item p-2 rounded-xl">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3a9 9 0 1 0 0 18 9 9 0 0 0 0-18Z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.7 2.4 4 5.8 4 9s-1.3 6.6-4 9c-2.7-2.4-4-5.8-4-9s1.3-6.6 4-9Z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12h15" />
      </svg>
    </a>

    <a *ngIf="currentUser"
       routerLink="/mon-espace"
       routerLinkActive="active"
       aria-label="Mon espace"
       title="Mon espace"
       class="menu-item p-2 rounded-xl">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="7" height="7" rx="1" />
        <rect x="14" y="3" width="7" height="7" rx="1" />
        <rect x="3" y="14" width="7" height="7" rx="1" />
        <rect x="14" y="14" width="7" height="7" rx="1" />
      </svg>
    </a>

    <a routerLink="/services"
       routerLinkActive="active"
       aria-label="Services"
       title="Services"
       class="menu-item p-2 rounded-xl">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-4.35-4.35M11 19a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z" />
      </svg>
    </a>

  <!--  <a routerLink="/prestataires"
       routerLinkActive="active"
       aria-label="Prestataires"
       title="Prestataires"
       class="menu-item p-2 rounded-xl">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 14c-5 0-7 3-7 5v1h14v-1c0-2-2-5-7-5Z" />
      </svg>
    </a> --> 

    <!-- Si NON connecté -->
    <a *ngIf="!(auth.user$ | async)"
       routerLink="/register"
       class="text-sm font-semibold text-[#1A1A1A] hover:text-[#FF7A00] transition">
      S'inscrire
    </a>

    <a *ngIf="!(auth.user$ | async)"
       routerLink="/login"
       class="inline-flex items-center gap-2 rounded-full border border-[#1A1A1A] text-[#1A1A1A] px-5 py-2 text-sm font-semibold hover:bg-[#1A1A1A] hover:text-white transition">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 11.25a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM5.25 19.5a6.75 6.75 0 0 1 13.5 0" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 10.5h2.25m0 0V12m0-1.5v-1.5" />
      </svg>
      Se connecter
    </a>

    <!-- Si connecté -->
    <ng-container *ngIf="auth.user$ | async as user">
    <!--  <a routerLink="/mes-services"
         routerLinkActive="active"
         aria-label="Mes services"
         title="Mes services"
         class="menu-item p-2 rounded-xl">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 9h16a1 1 0 0 1 1 1v8.5A1.5 1.5 0 0 1 19.5 20h-15A1.5 1.5 0 0 1 3 18.5V10a1 1 0 0 1 1-1Z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 13h18" />
      </svg>
      </a> --> 

      <a routerLink="/favoris"
         routerLinkActive="active"
         aria-label="Mes favoris"
         title="Mes favoris"
         class="menu-item p-2 rounded-xl">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 20.25c4.5-2.42 8-5.65 8-9.75A4.5 4.5 0 0 0 12 6a4.5 4.5 0 0 0-8 4.5c0 4.1 3.5 7.33 8 9.75Z" />
        </svg>
      </a>
<!--
      <a routerLink="/mes-rendez-vous"
         routerLinkActive="active"
         aria-label="Mes rendez-vous"
         title="Mes rendez-vous"
         class="menu-item relative p-2 rounded-xl">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6.5 4h11a2.5 2.5 0 0 1 2.5 2.5V19a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V6.5A2.5 2.5 0 0 1 6.5 4Z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M7 8h10" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 4v4M15 4v4" />
        </svg>
        <span *ngIf="pendingRequests > 0"
              class="absolute -top-1 -right-1 inline-flex items-center justify-center min-w-[1.25rem] px-1.5 text-[10px] font-bold text-white bg-red-500 rounded-full">
          {{ pendingRequests > 10 ? '10+' : pendingRequests }}
        </span>
      </a>

      <a routerLink="/mes-reservations"
         routerLinkActive="active"
         aria-label="Mes réservations"
         title="Mes réservations"
         class="menu-item relative p-2 rounded-xl">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h8M8 11h5" />
          <rect width="18" height="14" x="3" y="5" rx="2" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M7 3v4M17 3v4" />
        </svg>
        <span *ngIf="pendingReservations > 0"
              class="absolute -top-1 -right-1 inline-flex items-center justify-center min-w-[1.25rem] px-1.5 text-[10px] font-bold text-white bg-red-500 rounded-full">
          {{ pendingReservations > 10 ? '10+' : pendingReservations }}
        </span>
      </a> -->

      <div class="relative notification-menu">
        <button type="button"
                class="menu-item relative p-2 rounded-xl"
                aria-label="Notifications"
                (click)="toggleNotificationMenu()">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 5a4 4 0 0 1 4 4v2.764a2 2 0 0 0 .553 1.382l1.6 1.8A1 1 0 0 1 17.4 16H6.6a1 1 0 0 1-.753-1.654l1.6-1.8A2 2 0 0 0 8 11.764V9a4 4 0 0 1 4-4Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 16a2 2 0 1 0 4 0" />
          </svg>
          <span *ngIf="notificationBadgeCount"
                class="notification-badge">
            {{ notificationBadgeCount > 9 ? '9+' : notificationBadgeCount }}
          </span>
        </button>
        <div *ngIf="notificationMenuOpen" class="notification-dropdown">
          <div class="notification-header">
            Notifications récentes
          </div>
          <ul *ngIf="notifications.length; else notificationEmpty" class="notification-list">
            <li *ngFor="let item of notifications | slice:0:3">
              <button type="button" class="notification-item" (click)="openNotification(item)">
                <p class="notification-item__title">{{ item.title }}</p>
                <p class="notification-item__description">{{ item.description }}</p>
                <p class="notification-item__meta" *ngIf="item.createdAt">
                  {{ item.createdAt | date:'dd MMM · HH:mm' }}
                </p>
              </button>
            </li>
          </ul>
          <ng-template #notificationEmpty>
            <div class="notification-empty">
              Aucune notification pour le moment
            </div>
          </ng-template>
          <a routerLink="/notifications"
             (click)="closeNotificationMenu()"
             class="notification-footer">
            Voir toutes les notifications
          </a>
        </div>
      </div>

      <a routerLink="/messagerie"
         aria-label="Messagerie"
         routerLinkActive="active"
         class="menu-item inline-flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5A2.5 2.5 0 0 1 5.5 5h13A2.5 2.5 0 0 1 21 7.5v9a2.5 2.5 0 0 1-2.5 2.5h-13A2.5 2.5 0 0 1 3 16.5v-9Z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="m3 8 8.4 6.3a1 1 0 0 0 1.2 0L21 8" />
        </svg>
        <span *ngIf="unreadCount > 0"
              class="ml-1 inline-flex items-center justify-center text-xs font-bold text-white bg-red-500 rounded-full min-w-[1.5rem] px-2 py-0.5 leading-none">
          {{ unreadCount > 10 ? '10+' : unreadCount }}
        </span>
      </a>

      <a routerLink="/services/new"
         class="px-4 py-2 bg-[#FF7A00] text-white rounded-xl text-sm hover:bg-[#e66d00] transition">
        + Publier
      </a>

      <div class="relative user-menu" (click)="$event.stopPropagation()">
        <button type="button"
                (click)="toggleUserMenu()"
                class="flex items-center gap-2 px-3 py-2 rounded-xl border border-transparent hover:border-[#FFE0BF] transition">
          <img [src]="user.photoURL || 'assets/icone.png'" class="w-8 h-8 rounded-full object-cover border">
          <div class="flex items-center gap-1">
            <span class="font-semibold text-sm text-[#1A1A1A]">{{ displayName(user) }}</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </div>
        </button>

        <div *ngIf="userMenuOpen"
             class="absolute right-0 mt-3 w-64 bg-white rounded-2xl border border-[#FFE0BF] shadow-lg py-3 space-y-4">
         <!-- <div class="menu-section">
            <button type="button"
                    class="menu-section__header"
                    (click)="toggleUserSection('navigation')"
                    [attr.aria-expanded]="userMenuSections.navigation">
              <span>Navigation</span>
              <svg xmlns="http://www.w3.org/2000/svg"
                   class="chevron"
                   [class.chevron--open]="userMenuSections.navigation"
                   viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
              </svg>
            </button>
            <div class="menu-section__body" *ngIf="userMenuSections.navigation">
              <!-- <a routerLink="/"
                 routerLinkActive="active"
                 [routerLinkActiveOptions]="{ exact: true }"
                 (click)="closeUserMenu()"
                 class="menu-section__link">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 3a9 9 0 1 0 0 18 9 9 0 0 0 0-18Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.7 2.4 4 5.8 4 9s-1.3 6.6-4 9c-2.7-2.4-4-5.8-4-9s1.3-6.6 4-9Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12h15" />
                </svg>
                <span>Site internet</span>
              </a> 
              <a routerLink="/mon-espace"
                 routerLinkActive="active"
                 (click)="closeUserMenu()"
                 class="menu-section__link">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="4" y="4" width="7" height="7" rx="1" />
                  <rect x="13" y="4" width="7" height="7" rx="1" />
                  <rect x="4" y="13" width="7" height="7" rx="1" />
                  <rect x="13" y="13" width="7" height="7" rx="1" />
                </svg>
                <span>Mon espace</span>
              </a>
            </div>
          </div> -->

          <div class="menu-section">
            <button type="button"
                    class="menu-section__header"
                    (click)="toggleUserSection('profile')"
                    [attr.aria-expanded]="userMenuSections.profile">
              <span>Profil</span>
              <svg xmlns="http://www.w3.org/2000/svg"
                   class="chevron"
                   [class.chevron--open]="userMenuSections.profile"
                   viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
              </svg>
            </button>
            <div class="menu-section__body" *ngIf="userMenuSections.profile">
              <a routerLink="/mon-compte"
                 routerLinkActive="active"
                 (click)="closeUserMenu()"
                 class="menu-section__link">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm0 0c-4 0-7 2.5-7 5v1h14v-1c0-2.5-3-5-7-5Z" />
                </svg>
                <span>Mon compte</span>
              </a>
              <a [routerLink]="['/prestataires', user.uid]"
                 routerLinkActive="active"
                 (click)="closeUserMenu()"
                 class="menu-section__link">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 5.75h18M3 9.75h18M5 4.25h0a1.25 1.25 0 0 1 1.25 1.25v13a1.25 1.25 0 0 1-1.25 1.25H5a2 2 0 0 1-2-2V6.25A2 2 0 0 1 5 4.25Zm14 0h0a1.25 1.25 0 0 1 1.25 1.25v13a1.25 1.25 0 0 1-1.25 1.25H19a2 2 0 0 1-2-2V6.25a2 2 0 0 1 2-2Z" />
                </svg>
                <span>Mon profil public</span>
              </a>
              <a routerLink="/messagerie"
                 routerLinkActive="active"
                 (click)="closeUserMenu()"
                 class="menu-section__link">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5A2.5 2.5 0 0 1 5.5 5h13A2.5 2.5 0 0 1 21 7.5v9a2.5 2.5 0 0 1-2.5 2.5h-13A2.5 2.5 0 0 1 3 16.5v-9Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="m3 8 8.4 6.3a1 1 0 0 0 1.2 0L21 8" />
                </svg>
                <span class="flex items-center gap-2">
                  Messagerie
                  <span *ngIf="unreadCount > 0"
                        class="badge-inline">
                    {{ unreadCount > 10 ? '10+' : unreadCount }}
                  </span>
                </span>
              </a>
              <a routerLink="/notifications"
                 routerLinkActive="active"
                 (click)="closeUserMenu()"
                 class="menu-section__link">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 5a4 4 0 0 1 4 4v2.764a2 2 0 0 0 .553 1.382l1.6 1.8A1 1 0 0 1 17.4 16H6.6a1 1 0 0 1-.753-1.654l1.6-1.8A2 2 0 0 0 8 11.764V9a4 4 0 0 1 4-4Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M10 16a2 2 0 1 0 4 0" />
                </svg>
                <span>Notifications</span>
              </a>
            </div>
          </div>

          <div class="menu-section">
            <button type="button"
                    class="menu-section__header"
                    (click)="toggleUserSection('client')"
                    [attr.aria-expanded]="userMenuSections.client">
              <span>Menu client</span>
              <svg xmlns="http://www.w3.org/2000/svg"
                   class="chevron"
                   [class.chevron--open]="userMenuSections.client"
                   viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
              </svg>
            </button>
            <div class="menu-section__body" *ngIf="userMenuSections.client">
              <a routerLink="/services"
                 routerLinkActive="active"
                 (click)="closeUserMenu()"
                 class="menu-section__link">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-4.35-4.35M11 19a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z" />
                </svg>
                <span>Services</span>
              </a>
              <a routerLink="/prestataires"
                 routerLinkActive="active"
                 (click)="closeUserMenu()"
                 class="menu-section__link">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 14c-5 0-7 3-7 5v1h14v-1c0-2-2-5-7-5Z" />
                </svg>
                <span>Prestataires</span>
              </a>
              <a routerLink="/mes-reservations"
                 routerLinkActive="active"
                 (click)="closeUserMenu()"
                 class="menu-section__link">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h8M8 11h5" />
                  <rect width="18" height="14" x="3" y="5" rx="2" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M7 3v4M17 3v4" />
                </svg>
                <span class="flex items-center gap-2">
                  Mes réservations
                  <span *ngIf="pendingReservations > 0"
                        class="badge-inline">
                    {{ pendingReservations > 10 ? '10+' : pendingReservations }}
                  </span>
                </span>
              </a>
              <a routerLink="/favoris"
                 routerLinkActive="active"
                 (click)="closeUserMenu()"
                 class="menu-section__link">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 20.25c4.5-2.42 8-5.65 8-9.75A4.5 4.5 0 0 0 12 6a4.5 4.5 0 0 0-8 4.5c0 4.1 3.5 7.33 8 9.75Z" />
                </svg>
                <span>Mes favoris</span>
              </a>
            </div>
          </div>

          <div class="menu-section">
            <button type="button"
                    class="menu-section__header"
                    (click)="toggleUserSection('provider')"
                    [attr.aria-expanded]="userMenuSections.provider">
              <span>Mon business</span>
              <svg xmlns="http://www.w3.org/2000/svg"
                   class="chevron"
                   [class.chevron--open]="userMenuSections.provider"
                   viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
              </svg>
            </button>
            <div class="menu-section__body" *ngIf="userMenuSections.provider">
              <a routerLink="/mes-services"
                 routerLinkActive="active"
                 (click)="closeUserMenu()"
                 class="menu-section__link">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 9h16a1 1 0 0 1 1 1v8.5A1.5 1.5 0 0 1 19.5 20h-15A1.5 1.5 0 0 1 3 18.5V10a1 1 0 0 1 1-1Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 13h18" />
                </svg>
                <span>Mes services</span>
              </a>
              <a routerLink="/mes-rendez-vous"
                 routerLinkActive="active"
                 (click)="closeUserMenu()"
                 class="menu-section__link">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6.5 4h11a2.5 2.5 0 0 1 2.5 2.5V19a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V6.5A2.5 2.5 0 0 1 6.5 4Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M7 8h10" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 4v4M15 4v4" />
                </svg>
                <span class="flex items-center gap-2">
                  Mes rendez-vous
                  <span *ngIf="pendingRequests > 0"
                        class="badge-inline">
                    {{ pendingRequests > 10 ? '10+' : pendingRequests }}
                  </span>
                </span>
              </a>
              <a routerLink="/services/new"
                 (click)="closeUserMenu()"
                 class="menu-section__link">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v14m-7-7h14" />
                </svg>
                <span>Publier un service</span>
              </a>
            </div>
          </div>

          <button (click)="requestLogout()"
                  class="w-full text-left flex items-center gap-3 px-4 py-2 text-sm text-red-500 hover:bg-red-50 rounded-xl mx-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h-4a4 4 0 0 1 0-8h4" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 12h10m0 0-3-3m3 3-3 3" />
            </svg>
            <span>Déconnexion</span>
          </button>
        </div>
      </div>
    </ng-container>

  </div>


   <div class="md:hidden flex items-center gap-4" *ngIf="auth.user$ | async as user">
    <!-- <button type="button"
            class="relative text-[#FF7A00] focus:outline-none p-1"
            (click)="goToDashboard()">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <rect x="3" y="3" width="7" height="7" rx="1" />
        <rect x="14" y="3" width="7" height="7" rx="1" />
        <rect x="3" y="14" width="7" height="7" rx="1" />
        <rect x="14" y="14" width="7" height="7" rx="1" />
      </svg>
    </button> -->


   <!-- <button type="button"
            class="relative text-[#FF7A00] focus:outline-none p-1"
            (click)="goToWebsite()">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3a9 9 0 1 0 0 18 9 9 0 0 0 0-18Z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.7 2.4 4 5.8 4 9s-1.3 6.6-4 9c-2.7-2.4-4-5.8-4-9s1.3-6.6 4-9Z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12h15" />
      </svg>
    </button> -->
    <button type="button"
            class="relative text-[#FF7A00] focus:outline-none p-1"
            (click)="goToDashboard()">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <rect x="3" y="3" width="7" height="7" rx="1" />
        <rect x="14" y="3" width="7" height="7" rx="1" />
        <rect x="3" y="14" width="7" height="7" rx="1" />
        <rect x="14" y="14" width="7" height="7" rx="1" />
      </svg>
    </button>

    <button type="button"
            class="relative text-[#FF7A00] focus:outline-none p-1"
            (click)="goToNotifications()">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 5a4 4 0 0 1 4 4v2.764a2 2 0 0 0 .553 1.382l1.6 1.8A1 1 0 0 1 17.4 16H6.6a1 1 0 0 1-.753-1.654l1.6-1.8A2 2 0 0 0 8 11.764V9a4 4 0 0 1 4-4Z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M10 16a2 2 0 1 0 4 0" />
      </svg>
      <span *ngIf="notificationBadgeCount"
            class="absolute -top-1 -right-1 inline-flex items-center justify-center min-w-[1.1rem] px-1 text-[10px] font-bold text-white bg-red-500 rounded-full">
        {{ notificationBadgeCount > 9 ? '9+' : notificationBadgeCount }}
      </span>
    </button>

    <!-- <button type="button"
            class="relative text-[#FF7A00] focus:outline-none p-1"
            (click)="goToMessages()">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5A2.5 2.5 0 0 1 5.5 5h13A2.5 2.5 0 0 1 21 7.5v9a2.5 2.5 0 0 1-2.5 2.5h-13A2.5 2.5 0 0 1 3 16.5v-9Z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="m3 8 8.4 6.3a1 1 0 0 0 1.2 0L21 8" />
      </svg>
      <span *ngIf="unreadCount > 0"
            class="absolute -top-1 -right-1 inline-flex items-center justify-center min-w-[1.1rem] px-1 text-[10px] font-bold text-white bg-red-500 rounded-full">
        {{ unreadCount > 9 ? '9+' : unreadCount }}
      </span>
    </button> -->
    <button (click)="toggleMenu()" class="text-[#FF7A00] focus:outline-none p-1">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none"
        viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </div>

  <button (click)="toggleMenu()" class="md:hidden text-[#FF7A00] focus:outline-none" *ngIf="!(auth.user$ | async)">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none"
      viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round"
        d="M4 6h16M4 12h16M4 18h16" />
    </svg>
  </button>
</nav>


<!-- MENU SLIDE MOBILE -->
<div class="fixed top-0 right-0 h-full w-80 bg-white shadow-xl z-[9998] transform transition-transform duration-300 md:hidden flex flex-col"
     [class.translate-x-full]="!isMenuOpen">

  <div class="p-4 flex justify-end">
    <button (click)="toggleMenu()" class="text-gray-500">✖</button>
  </div>

  <div class="flex-1 pt-6 flex flex-col gap-4 px-6 overflow-y-auto">

    <ng-container *ngIf="currentUser as user; else mobileGuestHeader">
      <div class="flex flex-col items-center gap-3">
        <img [src]="user.photoURL || 'assets/icone.png'"
             class="w-16 h-16 rounded-full border-2 border-[#FFE0BF] object-cover">
        <div class="text-center">
          <p class="text-base font-semibold text-[#1A1A1A]">{{ displayName(user) }}</p>
          <p class="text-xs text-gray-500" *ngIf="user.pseudo && (user.firstname || user.lastname)">
             {{ user.lastname }} {{ user.firstname }}
          </p>
        </div>
      </div>
    </ng-container>

    <ng-template #mobileGuestHeader>
      <div class="flex flex-col items-center gap-3 text-center">
        <img src="assets/icone.png"
             alt="Avatar invité"
             class="w-16 h-16 rounded-full border-2 border-[#FFE0BF] object-cover">
        <div>
          <p class="text-base font-semibold text-[#1A1A1A]">Bienvenue sur Woya!</p>
          <p class="text-xs text-gray-500">Crée un compte ou connecte-toi pour accéder à toutes les fonctionnalités.</p>
        </div>
        <div class="flex gap-3 w-full">
          <a routerLink="/login"
             (click)="toggleMenu()"
             class="flex-1 text-sm font-semibold border border-[#1A1A1A] rounded-full px-4 py-2 text-[#1A1A1A] text-center">
            Se connecter
          </a>
          <a routerLink="/register"
             (click)="toggleMenu()"
             class="flex-1 text-sm font-semibold text-white bg-[#FF7A00] rounded-full px-4 py-2 text-center hover:bg-[#e66d00] transition">
            S'inscrire
          </a>
        </div>
      </div>
    </ng-template>

    <div class="global-search global-search--mobile" [class.global-search--open]="searchOpen">
      <input type="text"
             [value]="searchTerm"
             (input)="onSearchInput($event.target.value)"
             (focus)="onSearchFocus()"
             (keydown.enter)="submitSearch(); toggleMenu()"
             placeholder="Rechercher…">
      <div class="search-dropdown search-dropdown--mobile" *ngIf="searchOpen">
        <div *ngIf="searchLoading" class="search-state">Recherche…</div>
        <ng-container *ngIf="!searchLoading">
          <button type="button"
                  *ngFor="let result of searchResults"
                  class="search-item"
                  (click)="goToResult(result); toggleMenu()">
            <img [src]="result.avatar || 'assets/icone.png'" alt="" class="search-item__avatar">
            <div class="search-item__body">
              <p class="search-item__title">{{ result.label }}</p>
              <p class="search-item__subtitle">{{ result.description }}</p>
            </div>
            <span class="search-item__tag" [class.search-item__tag--user]="result.kind === 'user'">
              {{ result.kind === 'user' ? 'Profil' : 'Service' }}
            </span>
          </button>
          <div class="search-state" *ngIf="!searchResults.length">
            Aucun résultat
          </div>
        </ng-container>
      </div>
    </div>

    <div class="mobile-nav-section">
      <button type="button"
              class="mobile-nav-header"
              (click)="toggleMobileSection('navigation')"
              [attr.aria-expanded]="mobileMenuSections.navigation">
        <span>Navigation</span>
        <svg xmlns="http://www.w3.org/2000/svg"
             class="chevron"
             [class.chevron--open]="mobileMenuSections.navigation"
             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
        </svg>
      </button>
      <div class="mobile-nav-list" *ngIf="mobileMenuSections.navigation">
        <a routerLink="/"
           routerLinkActive="text-[#FF7A00]" [routerLinkActiveOptions]="{ exact: true }"
           (click)="toggleMenu()"
           class="mobile-nav-link">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3a9 9 0 1 0 0 18 9 9 0 0 0 0-18Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.7 2.4 4 5.8 4 9s-1.3 6.6-4 9c-2.7-2.4-4-5.8-4-9s1.3-6.6 4-9Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12h15" />
          </svg>
          <span>Site internet</span>
        </a>
        <a *ngIf="currentUser"
           routerLink="/mon-espace"
           routerLinkActive="text-[#FF7A00]"
           (click)="toggleMenu()"
           class="mobile-nav-link">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="4" y="4" width="7" height="7" rx="1" />
            <rect x="13" y="4" width="7" height="7" rx="1" />
            <rect x="4" y="13" width="7" height="7" rx="1" />
            <rect x="13" y="13" width="7" height="7" rx="1" />
          </svg>
          <span>Mon espace</span>
        </a>
      </div>
    </div>

    <div class="mobile-nav-section" *ngIf="currentUser as user">
      <button type="button"
              class="mobile-nav-header"
              (click)="toggleMobileSection('profile')"
              [attr.aria-expanded]="mobileMenuSections.profile">
        <span>Profil</span>
        <svg xmlns="http://www.w3.org/2000/svg"
             class="chevron"
             [class.chevron--open]="mobileMenuSections.profile"
             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
        </svg>
      </button>
      <div class="mobile-nav-list" *ngIf="mobileMenuSections.profile">
        <a routerLink="/mon-compte"
           routerLinkActive="text-[#FF7A00]"
           [routerLinkActiveOptions]="{ exact: true }"
           (click)="toggleMenu()"
           class="mobile-nav-link">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm0 0c-4 0-7 2.5-7 5v1h14v-1c0-2.5-3-5-7-5Z" />
          </svg>
          <span>Mon compte</span>
        </a>
        <a [routerLink]="['/prestataires', user.uid]"
           routerLinkActive="text-[#FF7A00]"
           (click)="toggleMenu()"
           class="mobile-nav-link">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 5.75h18M3 9.75h18M5 4.25h0a1.25 1.25 0 0 1 1.25 1.25v13a1.25 1.25 0 0 1-1.25 1.25H5a2 2 0 0 1-2-2V6.25A2 2 0 0 1 5 4.25Zm14 0h0a1.25 1.25 0 0 1 1.25 1.25v13a1.25 1.25 0 0 1-1.25 1.25H19a2 2 0 0 1-2-2V6.25a2 2 0 0 1 2-2Z" />
          </svg>
          <span>Mon profil public</span>
        </a>
        <a routerLink="/messagerie"
           aria-label="Messagerie"
           routerLinkActive="text-[#FF7A00]"
           (click)="toggleMenu()"
           class="mobile-nav-link">
          <svg xmlns="http://www.w3.org/2000/svg" class="text-[#FF7A00] w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5A2.5 2.5 0 0 1 5.5 5h13A2.5 2.5 0 0 1 21 7.5v9a2.5 2.5 0 0 1-2.5 2.5h-13A2.5 2.5 0 0 1 3 16.5v-9Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="m3 8 8.4 6.3a1 1 0 0 0 1.2 0L21 8" />
          </svg>
          <span>Messagerie</span>
          <span *ngIf="unreadCount > 0"
                class="badge-inline ml-1">
            {{ unreadCount > 10 ? '10+' : unreadCount }}
          </span>
        </a>
        <a routerLink="/notifications"
           routerLinkActive="text-[#FF7A00]"
           (click)="toggleMenu()"
           class="mobile-nav-link">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 5a4 4 0 0 1 4 4v2.764a2 2 0 0 0 .553 1.382l1.6 1.8A1 1 0 0 1 17.4 16H6.6a1 1 0 0 1-.753-1.654l1.6-1.8A2 2 0 0 0 8 11.764V9a4 4 0 0 1 4-4Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 16a2 2 0 1 0 4 0" />
          </svg>
          <span class="flex items-center gap-2">
            Notifications
            <span *ngIf="notificationBadgeCount"
                  class="badge-inline">
              {{ notificationBadgeCount > 9 ? '9+' : notificationBadgeCount }}
            </span>
          </span>
        </a>
      </div>
    </div>
    <div class="mobile-nav-section">
      <button type="button"
              class="mobile-nav-header"
              (click)="toggleMobileSection('client')"
              [attr.aria-expanded]="mobileMenuSections.client">
        <span>Menu client</span>
        <svg xmlns="http://www.w3.org/2000/svg"
             class="chevron"
             [class.chevron--open]="mobileMenuSections.client"
             viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
        </svg>
      </button>
      <div class="mobile-nav-list" *ngIf="mobileMenuSections.client">
        <a routerLink="/services"
           routerLinkActive="text-[#FF7A00]" [routerLinkActiveOptions]="{ exact: true }"
           (click)="toggleMenu()"
           class="mobile-nav-link">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-4.35-4.35M11 19a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z" />
          </svg>
          <span>Services</span>
        </a>
        <a routerLink="/prestataires"
           routerLinkActive="text-[#FF7A00]" [routerLinkActiveOptions]="{ exact: true }"
           (click)="toggleMenu()"
           class="mobile-nav-link">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 14c-5 0-7 3-7 5v1h14v-1c0-2-2-5-7-5Z" />
          </svg>
          <span>Prestataires</span>
        </a>
        <a *ngIf="currentUser"
           routerLink="/mes-reservations"
           routerLinkActive="text-[#FF7A00]"
           (click)="toggleMenu()"
           class="mobile-nav-link">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h8M8 11h5" />
            <rect width="18" height="14" x="3" y="5" rx="2" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M7 3v4M17 3v4" />
          </svg>
          <span class="flex items-center gap-2">
            Mes réservations
            <span *ngIf="pendingReservations > 0"
                  class="badge-inline">
              {{ pendingReservations > 10 ? '10+' : pendingReservations }}
            </span>
          </span>
        </a>
        <a *ngIf="currentUser"
           routerLink="/favoris"
           routerLinkActive="text-[#FF7A00]"
           (click)="toggleMenu()"
           class="mobile-nav-link">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.645 20.91a.75.75 0 0 0 .71 0c1.192-.634 7.095-4.099 7.095-10.16A4.75 4.75 0 0 0 12 7.438a4.75 4.75 0 0 0-7.45 3.312c0 6.06 5.903 9.525 7.095 10.159Z" />
          </svg>
          <span>Mes favoris</span>
        </a>
      </div>
    </div>

    <ng-container *ngIf="currentUser">
      <div class="mobile-nav-section">
        <button type="button"
                class="mobile-nav-header"
                (click)="toggleMobileSection('provider')"
                [attr.aria-expanded]="mobileMenuSections.provider">
          <span>mon business</span>
          <svg xmlns="http://www.w3.org/2000/svg"
               class="chevron"
               [class.chevron--open]="mobileMenuSections.provider"
               viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
          </svg>
        </button>
        <div class="mobile-nav-list" *ngIf="mobileMenuSections.provider">
          <a routerLink="/mes-services"
             routerLinkActive="text-[#FF7A00]"
             (click)="toggleMenu()"
             class="mobile-nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 7V5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 9h16a1 1 0 0 1 1 1v8.5A1.5 1.5 0 0 1 19.5 20h-15A1.5 1.5 0 0 1 3 18.5V10a1 1 0 0 1 1-1Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 13h18" />
            </svg>
            <span>Mes services</span>
          </a>
          <a routerLink="/mes-rendez-vous"
             routerLinkActive="text-[#FF7A00]"
             (click)="toggleMenu()"
             class="mobile-nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-[#FF7A00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6.5 4h11a2.5 2.5 0 0 1 2.5 2.5V19a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V6.5A2.5 2.5 0 0 1 6.5 4Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M7 8h10" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 4v4M15 4v4" />
            </svg>
            <span class="flex items-center gap-2">
              Mes rendez-vous
              <span *ngIf="pendingRequests > 0"
                    class="badge-inline">
                {{ pendingRequests > 10 ? '10+' : pendingRequests }}
              </span>
            </span>
          </a>
          <a routerLink="/services/new"
             (click)="toggleMenu()"
             class="mobile-nav-link mobile-nav-link--cta gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v14m-7-7h14" />
            </svg>
            <span>Publier un service</span>
          </a>
        </div>
      </div>
    </ng-container>

  </div>

  <div *ngIf="currentUser; else guestMobileCta" class="px-6 pb-8 pt-4 border-t border-[#FFE0BF]">
    <button (click)="requestLogout()" 
            class="w-full text-left text-red-500 font-semibold flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h-4a4 4 0 0 1 0-8h4" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 12h10m0 0-3-3m3 3-3 3" />
      </svg>
      <span>Déconnexion</span>
    </button>
  </div>
  <ng-template #guestMobileCta>
    <div class="px-6 pb-8 pt-4 border-t border-[#FFE0BF] text-sm text-center text-gray-600 space-y-3">
      <p>Pas encore de compte ? Rejoins nous pour publier ou réserver un service.</p>
      <div class="flex flex-col gap-3">
        <a routerLink="/register"
           (click)="toggleMenu()"
           class="w-full text-sm font-semibold text-white bg-[#FF7A00] rounded-full px-4 py-2 hover:bg-[#e66d00] transition">
          Créer un compte
        </a>
        <a routerLink="/login"
           (click)="toggleMenu()"
           class="w-full text-sm font-semibold border border-[#1A1A1A] rounded-full px-4 py-2 text-[#1A1A1A]">
          Se connecter
        </a>
      </div>
    </div>
  </ng-template>
</div>

<!-- BACKDROP -->
<div *ngIf="isMenuOpen" (click)="toggleMenu()" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-[9997] md:hidden"></div>

<!-- LOGOUT MODAL -->
<div *ngIf="logoutConfirmOpen"
     (click)="cancelLogout()"
     class="fixed inset-0 z-[10000] bg-black/50 backdrop-blur-sm flex items-center justify-center px-4">
  <div class="bg-white rounded-3xl shadow-xl border border-[#FFE0BF] max-w-sm w-full p-6 text-center"
       (click)="$event.stopPropagation()">
    <div class="mx-auto mb-4 w-12 h-12 rounded-full bg-red-50 flex items-center justify-center text-red-500">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v4m0 4h.01M12 5a7 7 0 1 1-7 7 7 7 0 0 1 7-7Z" />
      </svg>
    </div>
    <h3 class="text-lg font-semibold text-[#1A1A1A]">Se déconnecter ?</h3>
    <p class="text-sm text-gray-500 mt-2">Tu seras redirigé vers l’écran d’accueil et devras te reconnecter pour poursuivre.</p>
    <div class="mt-6 flex flex-col gap-3">
      <button type="button"
              (click)="confirmLogout()"
              class="w-full px-4 py-3 rounded-2xl bg-red-500 text-white font-semibold hover:bg-red-600 transition">
        Oui, me déconnecter
      </button>
      <button type="button"
              (click)="cancelLogout()"
              class="w-full px-4 py-3 rounded-2xl border border-gray-200 font-semibold text-gray-700 hover:bg-gray-50 transition">
        Annuler
      </button>
    </div>
  </div>
</div>
