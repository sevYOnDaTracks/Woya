<div class="min-h-screen bg-[#FFF7EB] px-4 md:px-16 py-6">

  <!-- SPINNER INIT -->
  <div *ngIf="loading" class="flex justify-center items-center py-24">
    <div class="animate-spin h-28 w-28 border-4 border-[#FF7A00] border-t-transparent rounded-full"></div>
  </div>

  <!-- SEARCH BAR -->
  <div *ngIf="!loading" class="bg-white rounded-2xl p-4 shadow-sm mb-6 flex flex-col md:flex-row md:items-center gap-3">
    <input [(ngModel)]="q" (input)="applyFilter()" type="text"
           placeholder="Rechercher un service, une ville..."
           class="flex-1 border rounded-xl px-4 py-3 outline-none" />

    <select [(ngModel)]="category" (change)="applyFilter()"
            class="border rounded-xl px-4 py-3">
      <option *ngFor="let c of categories" [value]="c">{{ c }}</option>
    </select>

  </div>

  <!-- GRID -->
  <div *ngIf="!loading && filtered.length > 0"
       class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">

    <article *ngFor="let s of filtered"
             class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition flex flex-col h-full">

      <!-- IMAGE + NAV -->
      <div class="relative h-40 rounded-t-2xl overflow-hidden cursor-pointer select-none"
           (click)="goToDetails(s.id!)">

        <img [src]="getCurrentImage(s)"
             class="w-full h-full object-cover transition-transform duration-200"
             [style.transform]="'translateX(' + (translateX[s.id!] || 0) + 'px)'"
             (touchstart)="onTouchStart(s, $event)"
             (touchmove)="onTouchMove(s, $event)"
             (touchend)="onTouchEnd(s)" />

        <button *ngIf="getImages(s).length > 1"
                (click)="prevImage(s, $event)"
                class="absolute top-1/2 left-2 -translate-y-1/2 bg-black/20 hover:bg-black/40 text-white rounded-full w-6 h-6 flex items-center justify-center backdrop-blur-sm">
          ‚Üê
        </button>

        <button *ngIf="getImages(s).length > 1"
                (click)="nextImage(s, $event)"
                class="absolute top-1/2 right-2 -translate-y-1/2 bg-black/20 hover:bg-black/40 text-white rounded-full w-6 h-6 flex items-center justify-center backdrop-blur-sm">
          ‚Üí
        </button>

      </div>

      <!-- CONTENT -->
      <div class="p-4 flex flex-col flex-1 justify-between">
        <div class="flex items-center justify-between"> <h3 class="font-bold text-lg text-[#1A1A1A] line-clamp-1">{{ s.title }}</h3> <span class="text-xs px-2 py-1 rounded-lg bg-[#FFF7EB] text-[#FF7A00]"> {{ s.category }} </span> </div>

       <!--  <p class="text-gray-600 mt-2 line-clamp-2">{{ s.description }}</p> -->

        <div class="mt-3 flex items-center justify-between text-sm text-gray-700">
          <span>üìç {{ s.city }}</span>
          <span *ngIf="s.price" class="font-semibold">{{ s.price | number:'1.0-0' }} FCFA</span>
        </div>

        <p *ngIf="s.createdAt" class="text-xs text-gray-400 mt-1">
          Publi√© {{ s.createdAt | timeAgo }}
        </p>


        <div class="mt-4 flex gap-2">
          <a (click)="goToDetails(s.id!)" class="flex-1 flex items-center justify-center px-3 py-2 rounded-xl border border-[#FF7A00] text-[#FF7A00] hover:bg-[#FF7A00] hover:text-white transition"> <!-- Ic√¥ne t√©l√©phone --> Voir + </a> <!-- Consulter --> 
          <a (click)="$event.stopPropagation()" [href]="phoneToWhatsApp(s.contact)" target="_blank" class="flex-1  flex items-center justify-center px-3 py-2 rounded-xl border border-[#3BAF4A] text-[#3BAF4A]"> <!-- Ic√¥ne t√©l√©phone --> <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 32 32" fill="green"> <path d="M16.027 3c-7.17 0-13 5.832-13 13.004 0 2.289.598 4.53 1.732 6.504L3 29l6.676-1.732a12.944 12.944 0 006.351 1.636h.002C23.196 28.904 29 23.07 29 16.002 29 8.832 23.197 3 16.027 3zm7.527 18.23c-.316.884-1.83 1.695-2.503 1.803-.642.105-1.47.152-2.375-.148-.548-.176-1.253-.407-2.157-.794-3.793-1.649-6.266-5.497-6.456-5.747-.19-.252-1.54-2.05-1.54-3.91 0-1.86.974-2.775 1.318-3.155.345-.38.753-.476 1.006-.476h.72c.23 0 .54-.086.845.646.316.762 1.072 2.625 1.165 2.816.092.19.153.413.03.665-.123.253-.185.413-.365.634-.19.222-.4.494-.57.664-.19.19-.387.397-.166.78.222.38.985 1.61 2.118 2.61 1.46 1.302 2.69 1.707 3.073 1.897.383.19.605.16.826-.096.222-.254.95-1.11 1.206-1.49.255-.381.508-.318.845-.19.345.127 2.18 1.028 2.556 1.214.377.191.63.286.723.445.094.16.094.93-.222 1.814z"/> </svg></a> <!-- Consulter --> 
        
          <!-- WhatsApp --> 
        
        </div>
      </div>

    </article>
  </div>

  <!-- NO RESULT -->
  <div *ngIf="!loading && filteredAll.length === 0"
       class="text-center text-gray-600 mt-10 text-sm">
    Aucun service trouv√© ü•≤
  </div>

  <!-- SPINNER LOAD MORE -->
  <div *ngIf="loadingMore" class="flex justify-center py-8">
    <div class="animate-spin h-24 w-24 border-4 border-[#FF7A00] border-t-transparent rounded-full"></div>
  </div>

</div>

