<section class="min-h-screen bg-[#FFF7EB] pt-4 pb-16 px-4">
  <div class="max-w-5xl mx-auto space-y-8">
    <div class="glass-card flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
      <div>
        <p class="hero-eyebrow">Mes réservations</p>
        <h1 class="hero-title text-2xl md:text-3xl">Suivre mes rendez-vous</h1>
        <p class="text-sm text-gray-500">Visualise tous les créneaux demandés auprès des prestataires et contacte-les facilement.</p>
      </div>
      <div class="flex gap-2 rounded-2xl border border-[#FFE0BF] bg-white p-1">
        <button type="button"
                class="tab-pill"
                [class.tab-pill--active]="view === 'upcoming'"
                (click)="switchView('upcoming')">
          À venir
        </button>
        <button type="button"
                class="tab-pill"
                [class.tab-pill--active]="view === 'history'"
                (click)="switchView('history')">
          Historique
        </button>
      </div>
    </div>

    <div class="glass-card flex flex-col gap-4" *ngIf="!loading">
      <div class="filters">
        <div class="filter-field">
          <label>Statut</label>
          <select [(ngModel)]="statusFilter" class="filter-control">
            <option value="all">Tous</option>
            <option value="pending">En attente</option>
            <option value="confirmed">Confirmés</option>
            <option value="cancelled">Annulés</option>
          </select>
        </div>
        <div class="filter-field">
          <label>Service</label>
          <input type="text"
                 [(ngModel)]="serviceFilter"
                 placeholder="Rechercher un service"
                 class="filter-control" />
        </div>
        <div class="filter-field">
          <label>Recherche</label>
          <input type="text"
                 [(ngModel)]="searchTerm"
                 placeholder="Prestataire ou service"
                 class="filter-control" />
        </div>
      </div>
    </div>

    <div *ngIf="loading" class="glass-card flex flex-col items-center gap-3 text-center mt-6">
      <div class="animate-spin h-10 w-10 border-4 border-[#FF7A00] border-t-transparent rounded-full"></div>
      <p class="text-sm text-gray-500">Chargement de tes réservations…</p>
    </div>

    <p *ngIf="error" class="text-sm text-red-500 text-center">{{ error }}</p>

    <ng-container *ngIf="!loading">
      <ng-container *ngIf="filteredBookings.length; else emptyState">
        <div class="space-y-4">
          <article *ngFor="let booking of filteredBookings" class="booking-card">
            <div class="booking-card__header">
              <div>
                <p class="booking-card__title">{{ booking.serviceTitle }}</p>
                <p class="booking-card__subtitle">
                  {{ booking.startTime | date:'EEEE d MMMM • HH:mm':'':'fr-FR' }}
                </p>
              </div>
              <span [class]="statusBadgeClass(booking.status)">
                {{ booking.status === 'pending' ? 'En attente' : (booking.status === 'confirmed' ? 'Confirmé' : 'Annulé') }}
              </span>
            </div>

            <div class="booking-card__body">
              <p class="text-sm text-gray-600">
                Prestataire :
                <a [routerLink]="providerProfileLink(booking)"
                   class="booking-link">
                  {{ providerName(booking) }}
                </a>
              </p>
              <p class="text-xs text-gray-500" *ngIf="booking.createdAt">
                Demande envoyée {{ booking.createdAt | timeAgo }}
              </p>
            </div>

            <div class="booking-card__actions">
              <button type="button"
                      class="secondary-btn"
                      [routerLink]="['/services', booking.serviceId]">
                Voir l'annonce
              </button>
              <button type="button"
                      class="icon-btn"
                      [disabled]="contactingId === (booking.id || booking.serviceId)"
                      (click)="contactProvider(booking)">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5A2.5 2.5 0 0 1 5.5 5h13A2.5 2.5 0 0 1 21 7.5v9a2.5 2.5 0 0 1-2.5 2.5h-13A2.5 2.5 0 0 1 3 16.5v-9Z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="m3 8 8.4 6.3a1 1 0 0 0 1.2 0L21 8" />
                </svg>
              </button>
            </div>
          </article>
        </div>
      </ng-container>

      <ng-template #emptyState>
        <div class="glass-card text-center">
          <p class="text-lg font-semibold text-[#1A1A1A] mb-2">
            Tu n'as pas encore réservé de créneau {{ view === 'history' ? 'confirmé' : '' }}.
          </p>
          <p class="text-sm text-gray-500">
            Explore les services disponibles pour demander un rendez-vous.
          </p>
          <button routerLink="/services" class="primary-btn mt-4">Explorer les services</button>
        </div>
      </ng-template>
    </ng-container>
  </div>
</section>
